@model VkPost
@using System.Text.RegularExpressions

@if (Model != null)
{
    <!-- Проверка и вывод видео -->
    @if (Model.VideoUrl != null && Model.VideoUrl.Any())
    {
        <div class="video-container">
            @foreach (var videoUrl in Model.VideoUrl)
            {
                var youtubeLink = Regex.Match(Model.Text, @"(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/[^\s]+");

                if (youtubeLink.Success)
                {
                    <div class="slider">
                        <div class="slides">
                            @foreach (var imageUrl in Model.ImageUrl)
                            {
                                <div class="slide">
                                    <img src="@imageUrl" alt="Slide Image">
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    // Если это обычное VK видео, отображаем его как плеер с автоплеем и скрытыми кнопками
                    <div class="video-container">
                        <iframe class="card-img-top" src="@videoUrl?autoplay=1&mute=1&controls=0&loop=1"
                                style="width: 100%; min-height:480px; max-height: 1080px; pointer-events: none;"
                                frameborder="0" allow="autoplay; encrypted-media"
                                allow="autoplay; encrypted-media; fullscreen; picture-in-picture; screen-wake-lock;"
                                allowfullscreen></iframe>
                    </div>
                }
            }
        </div>
    }
    else
    {
        <!-- Проверка и вывод фотографий -->
        @if (Model.ImageUrl.Count > 0 && !(Model.ImageUrl.Count == 1 && Model.ImageUrl[0] == "/img/no_photo_post.png"))
        {
            <div class="slider">
                <div class="slides">
                    @foreach (var imageUrl in Model.ImageUrl)
                    {
                        <div class="slide">
                            <img src="@imageUrl" alt="Slide Image">
                        </div>
                    }
                </div>

                @if (Model.ImageUrl.Count > 1)
                {
                    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                    <a class="next" onclick="plusSlides(1)">&#10095;</a>
                }
            </div>
        }
    }

    <p>
        @Html.Raw(Model.Text
                .Replace("____________________________________ ", "</p><p>")
                .Replace("——————————————————", "</p><p>")
                .Replace("—— ", ""))
    </p>
}
else
{
    <h1>Произошла ошибка</h1>
}

<!-- Стили слайдера -->
<style>
    .slider {
        position: relative;
        width: 100%;
        overflow: hidden;
    }

    .slides {
        display: flex;
        transition: transform 0.5s ease;
    }

    .slide {
        flex: 0 0 100%;
    }

    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        margin-top: -22px;
        padding: 16px;
        color: #9268c1;
        font-weight: bold;
        font-size: 192px;
        transition: 0.6s ease;
        border-radius: 50%;
        user-select: none;
        background-color: transparent;
        text-decoration: none;
        border: none;
        outline: none;
    }

    .next {
        right: 0;
        border-radius: 50%;
    }

        .prev:hover, .next:hover {
            color: #c0add6; /* Цвет при наведении */
        }

        .prev.active, .next.active {
            color: #c0add6;
        }
</style>

<!-- Скрипт слайдера -->
<script>
    var slideIndex = 1;
    showSlides(slideIndex);

    function plusSlides(n) {
        showSlides(slideIndex += n);
        updateButtonColors();
    }

    function currentSlide(n) {
        showSlides(slideIndex = n);
        updateButtonColors();
    }

    function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("slide");
        if (n > slides.length) { slideIndex = 1 }
        if (n < 1) { slideIndex = slides.length }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        slides[slideIndex - 1].style.display = "block";
    }

    function updateButtonColors() {
        var prevButton = document.querySelector('.prev');
        var nextButton = document.querySelector('.next');

        prevButton.classList.remove('active');
        nextButton.classList.remove('active');

        if (slideIndex > 1) {
            prevButton.classList.add('active');
        }
        if (slideIndex < slides.length) {
            nextButton.classList.add('active');
        }
    }
</script>